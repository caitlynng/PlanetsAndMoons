<!DOCTYPE html>
<html>
<head>
    <title>Home</title>
    <style>
        body {
            background-color: #3d348b;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            padding: 0 1em;
            background-image: url('https://wallpapers-clan.com/wp-content/uploads/2023/12/alien-planet-landscape-space-desktop-wallpaper-preview.jpg');
            background-size: cover;
            background-position: center;
        }

        h1 {
            color: #333;
        }

        input::placeholder {
            font-style: italic;
        }

        #header {
            display: flex;
            justify-content: flex-end;
            align-items: baseline;
            width: 100%;
            max-width: 1180px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            height: 90px;
        }

        #header h2 {
            font-size: 12px;
            margin: 0;
        }

        #greeting {
            margin-top: 3em;
            margin-bottom: 0;
            color: #fff;
        }

        #mainContent {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1200px;
            padding: 0;
            box-sizing: border-box;
            flex-grow: 1;
        }

        #searchPanel {
            max-height: 15em;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
            max-width: 1180px;
        }

        .search-group {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .search-group input {
            margin-right: 10px;
            width: auto;
        }

        #searchMoonInput {
            margin-left: 10px;
        }

        .search-group button {
            width: auto;
        }

        #bottomContent {
            display: flex;
            width: 100%;
            max-width: 1200px;
            padding: 0;
            box-sizing: border-box;
            flex-grow: 1;
        }

        #functions {
            flex: 1;
            max-width: 33%;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin: 10px;
            box-sizing: border-box;
            height: min-content;
        }

        #celestialTableContainer {
            flex: 2;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 15px;
            text-align: center; /* Center align text */
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #3d348b;
            color: white;
            font-weight: bold;
            letter-spacing: 1px;
            font-size: 14px;
        }

        td {
            font-size: 14px;
            color: #333;
        }

        #celestialTableContainer table th:nth-child(3),
        #celestialTableContainer table td:nth-child(3) {
            width: 40%; /* Allocate more space to the 'Name' column */
        }

        tr:hover {
            background-color: #f2f2f2;
        }

        select, input, button {
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            min-width: 8em;
        }

        .submit-button, #deleteButton, #searchPlanetButton, #searchMoonButton {
            background-color: #3d348b;
            color: #fff;
            border: none;
            cursor: pointer;
            width: 8em;
        }

        .submit-button:hover, #deleteButton:hover, #searchPlanetButton:hover, #searchMoonButton:hover {
            background-color: #b8b8ff;
            color: #3d348b;
        }

        #logoutButton {
            padding: 5px 10px;
            font-size: 0.8em;
            color: black;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 10px;
            background-color: #b8b8ff;
        }

        #logoutButton:hover {
            background-color: #fee440;
        }

        .container h2 {
            margin-top: 0;
        }

        .input-group {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        input[type="text"] {
            padding-right: 30px;
            width: 100%;
        }

        .clear-btn {
            position: absolute;
            right: 12px;
            top: 17px;
            cursor: pointer;
            font-size: 18px;
            color: #aaa;
            display: none;
        }

        .clear-btn:hover {
            color: #000;
        }

        .select-group {
            display: flex;
            gap: 1em;
            align-items: baseline;
        }

        @media (max-width: 768px) {
            #bottomContent {
                flex-direction: column;
            }

            #functions, #searchPanel, #celestialTableContainer {
                max-width: 100%;
                margin: 10px 0;
            }

            .search-group {
                flex-direction: column;
                align-items: flex-end;
            }

            .search-group input, .search-group button {
                margin-bottom: 10px;
                width: 100%;
            }

            table, thead, tbody, th, td, tr {
                display: block;
            }

            th, td {
                padding: 10px;
                text-align: right;
            }

            th::before, td::before {
                content: attr(data-label);
                float: left;
                font-weight: bold;
                text-transform: uppercase;
            }

            tr {
                margin-bottom: 15px;
            }

            th {
                background-color: #3d348b;
                color: white;
                font-weight: bold;
                text-transform: uppercase;
                letter-spacing: 1px;
                font-size: 12px;
                text-align: right;
            }

            td {
                font-size: 12px;
                text-align: right;
            }
        }

    </style>
</head>
<body>
<div id="header">
    <p id="greeting">Welcome</p>
    <button id="logoutButton" onclick="logout()">Logout</button>
</div>

<div id="mainContent">
    <div class="container" id="searchPanel">
        <h2></h2>
        <div class="search-group">
            <input id="searchPlanetInput" placeholder="Search Planet By Name or ID" type="text">
            <button id="searchPlanetButton" onclick="searchPlanet()">Search Planet</button>
            <input id="searchMoonInput" placeholder="Search Moon By Name or ID" type="text">
            <button id="searchMoonButton" onclick="searchMoon()">Search Moon</button>
        </div>
    </div>

    <div id="bottomContent">
        <div class="container" id="functions">
            <div class="select-group">
                <label for="locationSelect">Select type:</label>
                <select id="locationSelect">
                    <option value="moon">Moon</option>
                    <option value="planet">Planet</option>
                </select>
            </div>
            <div class="input-group" id="inputContainer"></div>
            <div class="input-group">
                <label for="deleteInput"></label>
                <input id="deleteInput" placeholder="Enter ID for celestial body to be deleted" type="text">
            </div>
            <div class="input-group">
                <button id="deleteButton" onclick="deleteCelestial()">Delete</button>
            </div>
        </div>

        <div class="container" id="celestialTableContainer">
            <table id="celestialTable">
                <tr>
                    <th>Type</th>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Owner</th>
                </tr>
            </table>
        </div>
    </div>
</div>

<script>
    populateCelestialTable();
    let userName = sessionStorage.getItem("user");
    userName = userName.charAt(0).toUpperCase() + userName.slice(1).toLowerCase();
    greeting.textContent = `Welcome ${userName}`;

    function populateInputContainer(selectedValue) {
        let inputContainer = document.getElementById('inputContainer');
        inputContainer.innerHTML = '';

        if (selectedValue === 'planet') {
            let planetNameInput = document.createElement('input');
            planetNameInput.type = 'text';
            planetNameInput.id = 'planetNameInput';
            planetNameInput.name = 'Planet Name';
            planetNameInput.placeholder = 'Enter Planet Name';
            inputContainer.appendChild(planetNameInput);

            let submitButton = document.createElement('button');
            submitButton.textContent = 'Submit Planet';
            submitButton.className = 'submit-button';
            submitButton.addEventListener('click', function() {
                let planetName = document.getElementById('planetNameInput').value;
                const bodyData = {
                    name: planetName,
                    ownerId: parseInt(sessionStorage.getItem("userId"))
                };
                const bodyJson = JSON.stringify(bodyData);
                const headersList = {
                    "Accept": "*/*",
                    "Content-Type": "application/json"
                };
                fetch('http://localhost:7001/api/planet', {
                    method: 'POST',
                    body: bodyJson,
                    headers: headersList,
                    credentials: 'include'
                }).then(response => {
                    if (response.status === 201) {
                        populateCelestialTable();
                        planetNameInput.value = '';
                    }

                    if (response.status === 500) {
                        alert("Failed to add planet");
                    }
                }).catch(error => {
                    alert("Something went wrong, check the console for details");
                });
            });
            inputContainer.appendChild(submitButton);
        } else if (selectedValue === 'moon') {
            let moonNameInput = document.createElement('input');
            moonNameInput.type = 'text';
            moonNameInput.id = 'moonNameInput';
            moonNameInput.name = 'Moon Name';
            moonNameInput.placeholder = 'Enter Moon Name';
            inputContainer.appendChild(moonNameInput);

            let orbitedPlanetInput = document.createElement('input');
            orbitedPlanetInput.type = 'text';
            orbitedPlanetInput.id = 'orbitedPlanetInput';
            orbitedPlanetInput.name = 'Orbited Planet';
            orbitedPlanetInput.placeholder = 'Enter Planet ID';
            inputContainer.appendChild(orbitedPlanetInput);

            let submitButton = document.createElement('button');
            submitButton.textContent = 'Submit Moon';
            submitButton.className = 'submit-button';
            submitButton.addEventListener('click', function() {
                let moonName = document.getElementById('moonNameInput').value;
                let orbitedPlanetId = document.getElementById('orbitedPlanetInput').value;
                const bodyData = {
                    name: moonName,
                    myPlanetId: parseInt(orbitedPlanetId)
                };
                const bodyJson = JSON.stringify(bodyData);
                const headersList = {
                    "Accept": "*/*",
                    "Content-Type": "application/json"
                };
                fetch('http://localhost:7001/api/moon', {
                    method: 'POST',
                    body: bodyJson,
                    headers: headersList,
                    credentials: 'include'
                }).then(response => {
                    if (response.status === 201) {
                        populateCelestialTable();
                        moonNameInput.value = '';
                        orbitedPlanetInput.value = '';
                    }
                    if (response.status === 500) {
                        alert("There was an error adding moon");
                    }
                }).catch(error => {
                    alert("Something went wrong, check the console for details");
                });
            });
            inputContainer.appendChild(submitButton);
        }
    }

    document.getElementById('locationSelect').addEventListener('change', function() {
        populateInputContainer(this.value);
    });

    populateInputContainer(document.getElementById('locationSelect').value);

    async function populateCelestialTable() {
        document.getElementById('celestialTable').innerHTML = '<tr><th>Type</th><th>ID</th><th>Name</th><th>Owner</th></tr>';
        const response = await fetch('http://localhost:7001/api/planet', {credentials: 'include'});
        if (response.ok) {
            const data = await response.json();
            console.log(data);
            const table = document.getElementById('celestialTable');
            data.forEach(planet => {
                const row = table.insertRow();
                const typeCell = row.insertCell(0);
                const idCell = row.insertCell(1);
                const nameCell = row.insertCell(2);
                const ownerCell = row.insertCell(3);
                typeCell.textContent = 'planet';
                idCell.textContent = planet.id;
                nameCell.textContent = planet.name;
                ownerCell.textContent = planet.ownerId;
            });
        }
        const moonResponse = await fetch('http://localhost:7001/api/moon', {credentials: 'include'});
        if (moonResponse.ok) {
            const moonData = await moonResponse.json();
            const table = document.getElementById('celestialTable');
            moonData.forEach(moon => {
                const row = table.insertRow();
                const typeCell = row.insertCell(0);
                const idCell = row.insertCell(1);
                const nameCell = row.insertCell(2);
                const ownerCell = row.insertCell(3);
                typeCell.textContent = 'moon';
                idCell.textContent = moon.id;
                nameCell.textContent = moon.name;
                ownerCell.textContent = moon.myPlanetId;
            });
        }
    }

    async function deleteCelestial() {
        const selectedOption = document.getElementById('locationSelect').value;
        const id = document.getElementById('deleteInput').value;

        let url;
        if (selectedOption === 'moon') {
            url = `http://localhost:7001/api/moon/${id}`;
        } else if (selectedOption === 'planet') {
            url = `http://localhost:7001/api/planet/${id}`;
        } else {
            alert('Invalid selection: choose moon or planet to delete');
            return;
        }
        const response = await fetch(url, {
            method: 'DELETE',
            credentials: 'include'
        });
        if (response.status === 202) {
            populateCelestialTable();
            if (selectedOption === 'moon') {
                alert(`Deleted moon with ID ${id}`);
            }
            if (selectedOption === 'planet') {
                alert(`Deleted planet with ID ${id}`);
            }
            console.log(response);
            document.getElementById('deleteInput').value = '';
        } else {
            alert(`Failed to delete ${selectedOption} with ID ${id}`);
        }
    }

    async function logout() {
        const requestData = {
            method: 'DELETE',
            credentials: 'include'
        };
        const response = await fetch('http://localhost:7001/logout', requestData);
        if (response.status === 200) {
            sessionStorage.clear();
            window.location.replace("http://localhost:7001/webpage/login");
        } else {
            alert('Failed to logout');
        }
    }

    document.getElementById('searchPlanetInput').addEventListener('change', async function() {
        let input = this.value.trim();
        if (!input) {
            await populateCelestialTable();
            return;
        }
        input = input.toLowerCase();
        let url;
        const highestPlanetId = getHighestPlanetId();
        if (!isNaN(input) && parseInt(input, 10) <= highestPlanetId) {
            url = `http://localhost:7001/api/planet/id/${input}`;
        } else {
            url = `http://localhost:7001/api/planet/name/${input}`;
        }
        const response = await fetch(url, {
            method: 'GET',
            credentials: 'include'
        });
        if (response.ok) {
            const data = await response.json();
            const table = document.getElementById('celestialTable');
            table.innerHTML = '<tr><th>Type</th><th>ID</th><th>Name</th><th>Owner</th></tr>';
            if (Array.isArray(data) && data.length > 0) {
                data.forEach(planet => {
                    const row = table.insertRow();
                    const typeCell = row.insertCell(0);
                    const idCell = row.insertCell(1);
                    const nameCell = row.insertCell(2);
                    const ownerCell = row.insertCell(3);
                    typeCell.textContent = 'planet';
                    idCell.textContent = planet.id;
                    nameCell.textContent = planet.name;
                    ownerCell.textContent = planet.ownerId;
                });
            } else if (!Array.isArray(data) && data) {
                const row = table.insertRow();
                const typeCell = row.insertCell(0);
                const idCell = row.insertCell(1);
                const nameCell = row.insertCell(2);
                const ownerCell = row.insertCell(3);
                typeCell.textContent = 'planet';
                idCell.textContent = data.id;
                nameCell.textContent = data.name;
                ownerCell.textContent = data.ownerId;
            } else {
                alert('No planet found with the provided input');
            }
        } else {
            alert('Failed: No planet found.');
        }
    });

    document.getElementById('searchMoonInput').addEventListener('change', async function() {
        let input = this.value.trim();
        if (!input) {
            await populateCelestialTable();
            return;
        }
        input = input.toLowerCase();
        let url;
        const highestMoonId = getHighestPlanetId();
        if (!isNaN(input) && parseInt(input, 10) <= highestMoonId) {
            url = `http://localhost:7001/api/moon/id/${input}`;
        } else {
            url = `http://localhost:7001/api/moon/name/${input}`;
        }
        const response = await fetch(url, {
            method: 'GET',
            credentials: 'include'
        });
        if (response.ok) {
            const data = await response.json();
            const table = document.getElementById('celestialTable');
            table.innerHTML = '<tr><th>Type</th><th>ID</th><th>Name</th><th>Owner</th></tr>';
            if (Array.isArray(data) && data.length > 0) {
                data.forEach(moon => {
                    const row = table.insertRow();
                    const typeCell = row.insertCell(0);
                    const idCell = row.insertCell(1);
                    const nameCell = row.insertCell(2);
                    const ownerCell = row.insertCell(3);
                    typeCell.textContent = 'moon';
                    idCell.textContent = moon.id;
                    nameCell.textContent = moon.name;
                    ownerCell.textContent = moon.myPlanetId;
                });
            } else if (!Array.isArray(data) && data) {
                const row = table.insertRow();
                const typeCell = row.insertCell(0);
                const idCell = row.insertCell(1);
                const nameCell = row.insertCell(2);
                const ownerCell = row.insertCell(3);
                typeCell.textContent = 'moon';
                idCell.textContent = data.id;
                nameCell.textContent = data.name;
                ownerCell.textContent = data.myPlanetId;
            } else {
                alert('No moon found with the provided input');
            }
        } else {
            alert('No moon found.');
        }
    });

    function getHighestPlanetId() {
        const rows = document.querySelectorAll('#celestialTable tr');
        let highestId = -1;
        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            if (cells.length > 0) {
                const id = parseInt(cells[1].innerText, 10);
                if (!isNaN(id) && id > highestId) {
                    highestId = id;
                }
            }
        });
        return highestId;
    }

    document.addEventListener('DOMContentLoaded', function() {
        const searchPlanetInput = document.getElementById('searchPlanetInput');
        const clearSearchPlanetInput = document.getElementById('clearSearchPlanetInput');
        const searchMoonInput = document.getElementById('searchMoonInput');
        const clearSearchMoonInput = document.getElementById('clearSearchMoonInput');

        function toggleClearButton(input, clearButton) {
            if (input.value.length > 0) {
                clearButton.style.display = 'block';
            } else {
                clearButton.style.display = 'none';
            }
        }

        searchPlanetInput.addEventListener('input', function() {
            toggleClearButton(searchPlanetInput, clearSearchPlanetInput);
        });

        clearSearchPlanetInput.addEventListener('mousedown', function(event) {
            event.stopPropagation();
            event.preventDefault();
            searchPlanetInput.value = '';
            toggleClearButton(searchPlanetInput, clearSearchPlanetInput);
            searchPlanetInput.focus();
            populateCelestialTable();
        });

        searchMoonInput.addEventListener('input', function() {
            toggleClearButton(searchMoonInput, clearSearchMoonInput);
        });

        clearSearchMoonInput.addEventListener('mousedown', function(event) {
            event.stopPropagation();
            event.preventDefault();
            searchMoonInput.value = '';
            toggleClearButton(searchMoonInput, clearSearchMoonInput);
            searchMoonInput.focus();
            populateCelestialTable();
        });
    });
</script>
</body>
</html>
